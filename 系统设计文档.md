# TransGuyane 跨境物流系统 - 系统设计文档

## 1. 系统概述

### 1.1 项目背景
TransGuyane 是一个专注于中国至法属圭亚那跨境物流的订单管理系统，为客户提供快递单号录入、查询、批次管理和消息通知等功能。

### 1.2 系统目标
- 提供便捷的快递单号录入和管理功能
- 实现自动快递公司识别
- 支持批次化订单管理
- 提供客户与管理员之间的消息通信
- 支持多端适配（PC、平板、手机）

---

## 2. 技术架构

### 2.1 前端技术栈
| 技术 | 版本 | 说明 |
|------|------|------|
| React | 18.x | 前端框架 |
| Ant Design | 5.x | UI组件库 |
| React Router | 6.x | 路由管理 |
| Axios | 1.x | HTTP请求库 |
| Day.js | 1.x | 日期处理 |

### 2.2 后端技术栈
| 技术 | 版本 | 说明 |
|------|------|------|
| Node.js | 18.x | 运行环境 |
| Express | 4.x | Web框架 |
| MongoDB | 6.x | 数据库 |
| Mongoose | 7.x | ODM |
| JWT | - | 身份认证 |
| bcryptjs | - | 密码加密 |

### 2.3 系统架构图

```
┌──────────────────────────────────────────────────────────────┐
│                        前端应用                               │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │
│  │  用户端     │ │  管理端     │ │  公共组件   │            │
│  │  - 录入页面 │ │  - 单号搜索 │ │  - 登录页面 │            │
│  │  - 信息页面 │ │  - 上传数据 │ │  - 注册页面 │            │
│  │  - 消息页面 │ │  - 批次管理 │ │  - 布局组件 │            │
│  │  - 批次页面 │ │  - 客户管理 │ │             │            │
│  │  - 单号搜索 │ │  - 消息中心 │ │             │            │
│  └─────────────┘ └─────────────┘ └─────────────┘            │
└───────────────────────────┬──────────────────────────────────┘
                            │ HTTP/HTTPS (Axios)
                            ▼
┌──────────────────────────────────────────────────────────────┐
│                        后端API                                │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │
│  │  认证模块   │ │  订单模块   │ │  用户模块   │            │
│  │  /auth/*    │ │  /orders/*  │ │  /users/*   │            │
│  └─────────────┘ └─────────────┘ └─────────────┘            │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │
│  │  批次模块   │ │  消息模块   │ │  导出模块   │            │
│  │  /batches/* │ │  /messages/*│ │  /export/*  │            │
│  └─────────────┘ └─────────────┘ └─────────────┘            │
└───────────────────────────┬──────────────────────────────────┘
                            │ Mongoose ODM
                            ▼
┌──────────────────────────────────────────────────────────────┐
│                    MongoDB Atlas                              │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │
│  │  users      │ │  orders     │ │  batches    │            │
│  └─────────────┘ └─────────────┘ └─────────────┘            │
│  ┌─────────────┐                                             │
│  │  messages   │                                             │
│  └─────────────┘                                             │
└──────────────────────────────────────────────────────────────┘
```

---

## 3. 数据模型设计

### 3.1 用户模型 (User)
```javascript
{
  _id: ObjectId,
  username: String,        // 用户名（真实姓名）
  password: String,        // 密码（bcrypt加密）
  nickname: String,        // 昵称
  email: String,           // 邮箱
  phone: String,           // 手机号
  role: String,            // 角色: 'user' | 'admin'
  openid: String,          // 微信OpenID
  avatar: String,          // 头像URL
  createdAt: Date,
  updatedAt: Date
}
```

### 3.2 订单模型 (Order)
```javascript
{
  _id: ObjectId,
  orderNumber: String,     // 快递单号
  customerName: String,    // 客户姓名
  status: String,          // 状态: '在路上' | '已签收' | '已发出'
  batchId: ObjectId,       // 关联批次ID
  batchName: String,       // 批次名称
  userId: ObjectId,        // 录入用户ID
  logisticsInfo: String,   // 物流信息
  logisticsUpdateTime: Date,
  createdAt: Date,
  updatedAt: Date
}
```

### 3.3 批次模型 (Batch)
```javascript
{
  _id: ObjectId,
  name: String,            // 批次名称
  period: String,          // 时段
  orderCount: Number,      // 订单数量
  orders: [ObjectId],      // 关联订单
  createdAt: Date,
  updatedAt: Date
}
```

### 3.4 消息模型 (Message)
```javascript
{
  _id: ObjectId,
  from: ObjectId,          // 发送者ID
  to: ObjectId,            // 接收者ID
  content: String,         // 消息内容
  isRead: Boolean,         // 是否已读
  createdAt: Date
}
```

---

## 4. API接口设计

### 4.1 认证接口 (/api/auth)
| 方法 | 路径 | 说明 | 认证 |
|------|------|------|------|
| POST | /register | 用户注册 | 否 |
| POST | /login | 账号登录 | 否 |
| POST | /wechat | 微信登录 | 否 |
| GET | /verify | Token验证 | 是 |

### 4.2 订单接口 (/api/orders)
| 方法 | 路径 | 说明 | 认证 |
|------|------|------|------|
| GET | / | 获取订单列表 | 可选 |
| GET | /search | 搜索订单 | 可选 |
| GET | /:id | 获取订单详情 | 可选 |
| POST | / | 创建订单 | 是 |
| PUT | /:id | 更新订单 | 是 |
| DELETE | /:id | 删除订单 | 是 |
| POST | /admin/import | 批量导入 | 管理员 |

### 4.3 用户接口 (/api/users)
| 方法 | 路径 | 说明 | 认证 |
|------|------|------|------|
| GET | / | 获取用户列表 | 管理员 |
| PUT | /:id/role | 更新用户角色 | 管理员 |

### 4.4 批次接口 (/api/batches)
| 方法 | 路径 | 说明 | 认证 |
|------|------|------|------|
| GET | / | 获取批次列表 | 可选 |
| GET | /:id | 获取批次详情 | 可选 |
| POST | / | 创建批次 | 管理员 |
| PUT | /:id | 更新批次 | 管理员 |
| DELETE | /:id | 删除批次 | 管理员 |

### 4.5 消息接口 (/api/messages)
| 方法 | 路径 | 说明 | 认证 |
|------|------|------|------|
| GET | /conversations | 获取对话列表 | 是 |
| GET | /:userId | 获取消息记录 | 是 |
| POST | / | 发送消息 | 是 |
| PUT | /:id/read | 标记已读 | 是 |

---

## 5. 页面结构

### 5.1 用户端页面
```
/user
├── /input      # 录入页面（需登录）
├── /info       # 信息页面（公开）
├── /messages   # 消息页面（需登录）
├── /batches    # 批次页面（公开）
└── /search     # 单号搜索（公开）
```

### 5.2 管理端页面
```
/admin
├── /search     # 单号搜索
├── /upload     # 上传数据
├── /batches    # 批次管理
├── /customers  # 客户管理
└── /messages   # 消息中心
```

---

## 6. UI设计规范

### 6.1 配色方案
| 用途 | 颜色代码 | 说明 |
|------|----------|------|
| 主色调 | #4F46E5 | 蓝紫色 |
| 成功色 | #10B981 | 绿色 |
| 警告色 | #F59E0B | 橙色 |
| 错误色 | #EF4444 | 红色 |
| 信息色 | #3B82F6 | 蓝色 |
| 文字主色 | #1F2937 | 深灰 |
| 文字辅助 | #6B7280 | 中灰 |
| 边框色 | #E5E7EB | 浅灰 |

### 6.2 圆角规范
- 小圆角: 6px
- 中圆角: 8px
- 大圆角: 12px
- 超大圆角: 16px

### 6.3 阴影规范
```css
--shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
--shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
```

---

## 7. 安全设计

### 7.1 认证机制
- JWT Token认证
- Token有效期: 7天
- 密码bcrypt加密（强度10）

### 7.2 权限控制
- 角色：user（普通用户）、admin（管理员）
- 中间件验证：authenticate、requireAdmin
- 用户只能操作自己的数据

### 7.3 数据验证
- express-validator输入验证
- Mongoose Schema验证
- XSS防护

---

## 8. 部署架构

### 8.1 开发环境
```
前端: localhost:3000
后端: localhost:5000
数据库: MongoDB Atlas
```

### 8.2 生产环境
```
前端: Nginx静态托管
后端: PM2进程管理
数据库: MongoDB Atlas
容器化: Docker + Docker Compose
```

---

## 9. 文件结构

```
货柜服务网站/
├── frontend/                 # 前端代码
│   ├── public/
│   │   ├── index.html
│   │   └── logo.jpg
│   └── src/
│       ├── App.js
│       ├── index.js
│       ├── index.css
│       ├── contexts/
│       │   └── AuthContext.js
│       ├── layouts/
│       │   ├── UserLayout.js
│       │   └── AdminLayout.js
│       ├── pages/
│       │   ├── Login.js
│       │   ├── Login.css
│       │   ├── Register.js
│       │   ├── user/
│       │   │   ├── Input.js
│       │   │   ├── Info.js
│       │   │   ├── Messages.js
│       │   │   ├── Batches.js
│       │   │   └── Search.js
│       │   └── admin/
│       │       ├── Search.js
│       │       ├── Upload.js
│       │       ├── Batches.js
│       │       ├── Customers.js
│       │       └── Messages.js
│       ├── services/
│       │   └── api.js
│       └── utils/
│           └── courierDetector.js
├── backend/                  # 后端代码
│   ├── server.js
│   ├── middleware/
│   │   └── auth.js
│   ├── models/
│   │   ├── User.js
│   │   ├── Order.js
│   │   ├── Batch.js
│   │   └── Message.js
│   ├── routes/
│   │   ├── auth.js
│   │   ├── orders.js
│   │   ├── batches.js
│   │   ├── messages.js
│   │   ├── users.js
│   │   └── export.js
│   └── scripts/
│       └── createAdmin.js
└── deploy-package/           # 部署包
```

---

*文档版本: v2.0*
*更新日期: 2026-01-20*
*作者: TransGuyane开发团队*
