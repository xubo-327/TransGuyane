# ç®¡ç†å‘˜è´¦æˆ·å®Œæ•´éªŒè¯å’Œç™»å½•æµç¨‹

## âœ… æœ¬åœ°éªŒè¯ç»“æœ

### æ•°æ®åº“è´¦æˆ·éªŒè¯ï¼ˆå·²å®Œæˆï¼‰

**éªŒè¯å‘½ä»¤**ï¼š`node backend/scripts/verifyAdminUsers.js`

**éªŒè¯ç»“æœ**ï¼šâœ… **æ‰€æœ‰ 3 ä¸ªè´¦æˆ·éªŒè¯é€šè¿‡**

```
âœ… admin: éªŒè¯é€šè¿‡
   è§’è‰²: superadmin, ç™»å½•ç±»å‹: account, æ˜µç§°: è¶…çº§ç®¡ç†å‘˜

âœ… xubo327: éªŒè¯é€šè¿‡
   è§’è‰²: admin, ç™»å½•ç±»å‹: account, æ˜µç§°: æ™®é€šç®¡ç†å‘˜

âœ… zhousuda: éªŒè¯é€šè¿‡
   è§’è‰²: admin, ç™»å½•ç±»å‹: account, æ˜µç§°: æ™®é€šç®¡ç†å‘˜
```

## ğŸ“‹ å‰åç«¯å’Œæ•°æ®åº“ä¸€è‡´æ€§æ£€æŸ¥

### 1. æ•°æ®åº“æ¨¡å‹ï¼ˆåç«¯ï¼‰

**æ–‡ä»¶**: `backend/models/User.js`

```javascript
role: {
  type: String,
  enum: ['user', 'admin', 'superadmin'],  // âœ… ä¸‰ç§è§’è‰²
  default: 'user'
},
loginType: {
  type: String,
  enum: ['account', 'wechat'],  // âœ… ä¸¤ç§ç™»å½•ç±»å‹
  default: 'account'
}
```

### 2. åç«¯ç™»å½•é€»è¾‘ï¼ˆä¸€è‡´ï¼‰

**æ–‡ä»¶**: `backend/routes/auth.js`

```javascript
// âœ… æŸ¥è¯¢æ¡ä»¶ï¼šè¦æ±‚ loginType = 'account'
const user = await User.findOne({
  $or: [
    { username },
    { email: username },
    { phone: username }
  ],
  loginType: 'account'  // âœ… ä¸åˆ›å»ºè´¦æˆ·æ—¶çš„ loginType ä¸€è‡´
});

// âœ… è¿”å›ç”¨æˆ·è§’è‰²
res.json({
  token,
  user: {
    role: user.role  // âœ… å¯ä»¥æ˜¯ 'admin' æˆ– 'superadmin'
  }
});
```

### 3. å‰ç«¯ç™»å½•è·³è½¬ï¼ˆä¸€è‡´ï¼‰

**æ–‡ä»¶**: `frontend/src/pages/Login.js`

```javascript
// âœ… æ ¹æ®è§’è‰²è·³è½¬
if (response.user.role === 'admin' || response.user.role === 'superadmin') {
  navigate('/admin/info');  // âœ… ç®¡ç†å‘˜è·³è½¬åˆ°ç®¡ç†é¡µé¢
} else {
  navigate('/user/info');
}
```

### 4. å‰ç«¯è·¯ç”±ä¿æŠ¤ï¼ˆä¸€è‡´ï¼‰

**æ–‡ä»¶**: `frontend/src/App.js`

```javascript
// âœ… ç®¡ç†ç«¯è·¯ç”±ä¿æŠ¤
<Route path="/admin" element={<ProtectedRoute requireAdmin>...</ProtectedRoute>}>

// âœ… æƒé™æ£€æŸ¥é€»è¾‘
if (requireAdmin && user.role !== 'admin' && user.role !== 'superadmin') {
  return <Navigate to="/user/info" replace />;  // âœ… éç®¡ç†å‘˜é‡å®šå‘
}
```

### 5. åç«¯æƒé™ä¸­é—´ä»¶ï¼ˆä¸€è‡´ï¼‰

**æ–‡ä»¶**: `backend/middleware/auth.js`

```javascript
// âœ… ç®¡ç†å‘˜æƒé™æ£€æŸ¥
const requireAdmin = (req, res, next) => {
  if (!req.user || (req.user.role !== 'admin' && req.user.role !== 'superadmin')) {
    return res.status(403).json({ error: 'éœ€è¦ç®¡ç†å‘˜æƒé™' });
  }
  next();
};
```

## ğŸ¯ å®Œæ•´ç™»å½•æµç¨‹éªŒè¯

### æ­¥éª¤ 1: å‰ç«¯å‘é€ç™»å½•è¯·æ±‚

```javascript
POST /api/auth/login
{
  "username": "admin",
  "password": "admin123"
}
```

### æ­¥éª¤ 2: åç«¯éªŒè¯å’Œå¤„ç†

1. âœ… æŸ¥æ‰¾ç”¨æˆ·ï¼š`username = "admin"`, `loginType = "account"`
2. âœ… éªŒè¯å¯†ç ï¼šä½¿ç”¨ `user.comparePassword(password)`
3. âœ… ç”Ÿæˆ JWTï¼šåŒ…å« `{ role: "superadmin" }`
4. âœ… è¿”å›å“åº”ï¼š
   ```json
   {
     "token": "...",
     "user": {
       "role": "superadmin",
       "username": "admin",
       ...
     }
   }
   ```

### æ­¥éª¤ 3: å‰ç«¯å¤„ç†ç™»å½•å“åº”

1. âœ… ä¿å­˜ tokenï¼š`localStorage.setItem('token', response.token)`
2. âœ… è®¾ç½®ç”¨æˆ·çŠ¶æ€ï¼š`setUser(response.user)`
3. âœ… æ£€æŸ¥è§’è‰²ï¼š`response.user.role === 'superadmin'`
4. âœ… è·³è½¬è·¯ç”±ï¼š`navigate('/admin/info')`

### æ­¥éª¤ 4: è·¯ç”±ä¿æŠ¤éªŒè¯

1. âœ… `ProtectedRoute` æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
2. âœ… `requireAdmin` æ£€æŸ¥ `user.role !== 'admin' && user.role !== 'superadmin'`
3. âœ… éªŒè¯é€šè¿‡ï¼Œæ¸²æŸ“ `<AdminLayout>`

## ğŸ“ ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯

### å·²åˆ›å»ºå¹¶éªŒè¯çš„ç®¡ç†å‘˜è´¦æˆ·ï¼š

| ç”¨æˆ·å | å¯†ç  | è§’è‰² | loginType | è·³è½¬é¡µé¢ | çŠ¶æ€ |
|--------|------|------|-----------|----------|------|
| `admin` | `admin123` | `superadmin` | `account` | `/admin/info` | âœ… éªŒè¯é€šè¿‡ |
| `xubo327` | `3273279x` | `admin` | `account` | `/admin/info` | âœ… éªŒè¯é€šè¿‡ |
| `zhousuda` | `20260101` | `admin` | `account` | `/admin/info` | âœ… éªŒè¯é€šè¿‡ |

## âœ… ä¸€è‡´æ€§éªŒè¯æ€»ç»“

### å‰åç«¯ä¸€è‡´æ€§ï¼šâœ… **å®Œå…¨ä¸€è‡´**

| æ£€æŸ¥é¡¹ | åç«¯ | å‰ç«¯ | ä¸€è‡´æ€§ |
|--------|------|------|--------|
| è§’è‰²å®šä¹‰ | `['user', 'admin', 'superadmin']` | `['user', 'admin', 'superadmin']` | âœ… |
| ç®¡ç†å‘˜åˆ¤æ–­ | `role === 'admin' \|\| role === 'superadmin'` | `role === 'admin' \|\| role === 'superadmin'` | âœ… |
| loginType è¦æ±‚ | `loginType: 'account'` | `loginType: 'account'` | âœ… |
| ç™»å½•è·³è½¬é€»è¾‘ | è¿”å› `user.role` | æ ¹æ® `role` è·³è½¬ `/admin/info` | âœ… |

### æ•°æ®åº“ä¸€è‡´æ€§ï¼šâœ… **éªŒè¯é€šè¿‡**

- âœ… æ‰€æœ‰è´¦æˆ·å­˜åœ¨
- âœ… è§’è‰²æ­£ç¡®ï¼ˆ`admin` æˆ– `superadmin`ï¼‰
- âœ… loginType æ­£ç¡®ï¼ˆ`account`ï¼‰
- âœ… å¯†ç éªŒè¯é€šè¿‡
- âœ… æ˜µç§°æ­£ç¡®

## ğŸš€ æœ¬åœ°æµ‹è¯•æ­¥éª¤

### 1. éªŒè¯è´¦æˆ·å­˜åœ¨

```bash
cd backend
node scripts/verifyAdminUsers.js
```

**é¢„æœŸè¾“å‡º**ï¼š
```
âœ… éªŒè¯é€šè¿‡: 3 ä¸ªè´¦æˆ·
âŒ éœ€è¦ä¿®å¤: 0 ä¸ªè´¦æˆ·
```

### 2. å¯åŠ¨åç«¯æœåŠ¡ï¼ˆæœ¬åœ°æµ‹è¯•ï¼‰

```bash
cd backend
npm start
```

### 3. å¯åŠ¨å‰ç«¯æœåŠ¡ï¼ˆæœ¬åœ°æµ‹è¯•ï¼‰

```bash
cd frontend
npm start
```

### 4. æµ‹è¯•ç™»å½•

1. è®¿é—®ï¼šhttp://localhost:3000
2. æ‰“å¼€ç™»å½•é¡µé¢
3. å¯ç”¨"ç®¡ç†å‘˜ç™»å½•æ¨¡å¼"å¼€å…³
4. ä½¿ç”¨ä»»ä¸€ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼š
   - ç”¨æˆ·åï¼š`admin`ï¼Œå¯†ç ï¼š`admin123`
   - æˆ– ç”¨æˆ·åï¼š`xubo327`ï¼Œå¯†ç ï¼š`3273279x`
   - æˆ– ç”¨æˆ·åï¼š`zhousuda`ï¼Œå¯†ç ï¼š`20260101`
5. **é¢„æœŸç»“æœ**ï¼š
   - âœ… ç™»å½•æˆåŠŸ
   - âœ… è‡ªåŠ¨è·³è½¬åˆ° `/admin/info`ï¼ˆç®¡ç†ç«¯é¦–é¡µï¼‰
   - âœ… å¯ä»¥çœ‹åˆ°ç®¡ç†ç«¯èœå•å’ŒåŠŸèƒ½

## ğŸ” å¦‚æœç™»å½•åæ— æ³•è¿›å…¥ç®¡ç†é¡µé¢

### æ£€æŸ¥æ¸…å•ï¼š

1. **æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°**
   - æŸ¥çœ‹æ˜¯å¦æœ‰ JavaScript é”™è¯¯
   - æŸ¥çœ‹ç™»å½•è¯·æ±‚çš„å“åº”ï¼š`response.user.role` æ˜¯å¦æ­£ç¡®
   - æŸ¥çœ‹æ˜¯å¦æœ‰è·¯ç”±è·³è½¬é”™è¯¯

2. **æ£€æŸ¥ç”¨æˆ·çŠ¶æ€**
   ```javascript
   // åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ
   const user = JSON.parse(localStorage.getItem('user') || '{}');
   console.log('å½“å‰ç”¨æˆ·:', user);
   console.log('ç”¨æˆ·è§’è‰²:', user.role);
   ```

3. **æ£€æŸ¥è·¯ç”±**
   ```javascript
   // åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ
   console.log('å½“å‰è·¯å¾„:', window.location.hash);
   ```

4. **æ¸…é™¤ç¼“å­˜é‡è¯•**
   - æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’Œ localStorage
   - é‡æ–°ç™»å½•

## âœ… æœ€ç»ˆç»“è®º

### ä»£ç ä¸€è‡´æ€§ï¼šâœ… **å®Œå…¨ä¸€è‡´**

- âœ… å‰åç«¯è§’è‰²å®šä¹‰ä¸€è‡´
- âœ… ç™»å½•é€»è¾‘ä¸€è‡´
- âœ… è·¯ç”±ä¿æŠ¤ä¸€è‡´
- âœ… æ•°æ®åº“è´¦æˆ·éªŒè¯é€šè¿‡
- âœ… æœ¬åœ°è´¦æˆ·åˆ›å»ºå’ŒéªŒè¯æˆåŠŸ

### é¢„æœŸè¡Œä¸ºï¼š

**å½“ç®¡ç†å‘˜è´¦æˆ·ç™»å½•å**ï¼š
1. âœ… ç™»å½•æˆåŠŸï¼Œè¿”å›æ­£ç¡®çš„ `role`
2. âœ… å‰ç«¯æ£€æµ‹åˆ°ç®¡ç†å‘˜è§’è‰²
3. âœ… è‡ªåŠ¨è·³è½¬åˆ° `/admin/info`
4. âœ… è·¯ç”±ä¿æŠ¤éªŒè¯é€šè¿‡
5. âœ… æˆåŠŸè¿›å…¥ç®¡ç†é¡µé¢

**å¦‚æœä»æ— æ³•ç™»å½•åˆ°ç®¡ç†é¡µé¢ï¼Œè¯·æ£€æŸ¥**ï¼š
1. Vercel éƒ¨ç½²çŠ¶æ€ï¼ˆæ˜¯å¦ä¸º Readyï¼‰
2. Vercel ç¯å¢ƒå˜é‡é…ç½®ï¼ˆMONGODB_URIï¼‰
3. æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
4. Vercel Runtime Logs ä¸­çš„ç™»å½•æ—¥å¿—

---

**æ€»ç»“**ï¼šæ‰€æœ‰ä»£ç é€»è¾‘ä¸€è‡´ï¼Œè´¦æˆ·å·²éªŒè¯é€šè¿‡ã€‚ç®¡ç†å‘˜ç™»å½•ååº”è¯¥èƒ½å¤ŸæˆåŠŸè·³è½¬åˆ°ç®¡ç†é¡µé¢ã€‚
