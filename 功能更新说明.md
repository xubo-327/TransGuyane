# 功能更新说明

## 更新内容

### 1. 网站品牌更新 ✅
- **Logo名称：** TransGuyane
- **中文简介：** 中国——法圭跨境物流运输！
- **显示位置：**
  - 登录页面
  - 注册页面
  - 用户端页面头部
  - 网站标题

### 2. 用户名规则调整 ✅
- **字段名称：** 从"用户名"改为"真实姓名"
- **验证规则：**
  - 支持中文和英文姓名
  - 长度：2-20个字符
  - 允许中文字符、英文字母和空格
  - 移除了数字和下划线的限制
- **提示信息：** "请输入您的真实姓名（支持中文和英文）"

### 3. 访问权限调整 ✅
- **未登录用户可以：**
  - ✅ 访问用户端查看页面（单号搜索、信息页面、批次页面）
  - ✅ 搜索和查看所有订单数据（公开数据）
  - ✅ 查看所有批次信息
  - ❌ 不能编辑、删除订单
  - ❌ 不能录入新订单
  - ❌ 不能发送消息

- **需要登录才能操作：**
  - 订单录入（申报数据）
  - 编辑订单
  - 删除订单
  - 消息功能

### 4. 前端界面调整 ✅
- **用户端头部：**
  - 显示公司名称：TransGuyane
  - 显示中文简介：中国——法圭跨境物流运输
  - 未登录时显示"登录"按钮
  - 登录后显示用户名和"退出登录"

- **查看页面：**
  - 未登录用户可以正常查看数据
  - 编辑/删除按钮仅登录用户可见
  - 未登录时显示"登录后可操作"提示

### 5. 后端API调整 ✅
- **新增可选认证中间件：** `optionalAuthenticate`
  - 允许未登录访问
  - 如果有token则验证并设置用户信息
  - 如果没有token则继续执行（req.user = null）

- **API权限调整：**
  - `GET /api/orders/search` - 允许未登录访问
  - `GET /api/orders` - 允许未登录访问
  - `GET /api/batches` - 允许未登录访问
  - `GET /api/batches/:id` - 允许未登录访问
  - `POST /api/orders` - 需要登录（创建订单）
  - `PUT /api/orders/:id` - 需要登录（更新订单）
  - `DELETE /api/orders/:id` - 需要登录（删除订单）

## 用户体验优化

### 未登录用户
1. 直接访问网站可以查看所有公开数据
2. 需要操作时会提示登录
3. 点击"登录"按钮跳转到登录页面
4. 登录后自动返回原页面

### 已登录用户
1. 可以查看自己的数据（普通用户）或所有数据（管理员）
2. 可以进行所有操作
3. 头部显示用户名

## 数据访问规则

### 未登录用户
- 可以查看所有订单（公开数据）
- 可以查看所有批次
- 无法区分数据归属

### 登录用户（普通用户）
- 可以查看自己的订单
- 只能看到包含自己订单的批次
- 可以编辑和删除自己的订单
- 可以创建新订单

### 登录用户（管理员）
- 可以查看所有订单
- 可以查看所有批次
- 可以编辑和删除所有订单
- 可以导入订单数据
- 可以管理批次

## 前后端一致性验证

✅ **已确保一致性：**
- API路径匹配
- 请求/响应格式一致
- 认证逻辑一致
- 错误处理一致
- 数据访问权限一致

## 测试建议

### 未登录访问测试
- [ ] 直接访问 `/user/search` 可以查看数据
- [ ] 搜索订单功能正常
- [ ] 查看信息页面正常
- [ ] 查看批次页面正常
- [ ] 编辑/删除按钮不显示或提示登录

### 登录后测试
- [ ] 登录后可以正常操作
- [ ] 可以看到自己的数据
- [ ] 可以录入新订单
- [ ] 可以编辑和删除订单

---

**更新时间：** 2026-01-16  
**状态：** ✅ 所有功能已更新完成
