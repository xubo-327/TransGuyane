# 启动说明

## 快速启动步骤

### 1. 安装依赖

```bash
# 方法1：一键安装所有依赖
npm run install-all

# 方法2：分别安装
cd backend && npm install
cd ../frontend && npm install
```

### 2. 配置环境变量

#### 后端配置（backend/.env）

创建 `backend/.env` 文件，内容如下：

```env
PORT=5000
MONGODB_URI=mongodb://localhost:27017/warehouse_management
JWT_SECRET=your_secret_key_here_change_in_production
WECHAT_APPID=your_wechat_appid
WECHAT_SECRET=your_wechat_secret
```

**注意**：
- 如果没有MongoDB，请先安装并启动MongoDB服务
- JWT_SECRET建议使用随机生成的强密码
- 微信AppID和Secret需要从微信公众平台获取（开发环境可暂时不填，使用模拟登录）

#### 前端配置（frontend/.env）

创建 `frontend/.env` 文件，内容如下：

```env
REACT_APP_API_URL=http://localhost:5000/api
```

### 3. 启动MongoDB（如果还未启动）

```bash
# Windows
mongod

# macOS/Linux
sudo mongod

# 或使用Docker
docker run -d -p 27017:27017 --name mongodb mongo
```

### 4. 启动项目

#### 方法1：同时启动前后端（推荐）

```bash
npm run dev
```

#### 方法2：分别启动

```bash
# 终端1：启动后端
cd backend
npm run dev

# 终端2：启动前端
cd frontend
npm start
```

### 5. 访问应用

- 前端地址：http://localhost:3000
- 后端API地址：http://localhost:5000/api

## 首次使用

### 创建管理员账户

系统首次使用需要创建管理员账户。有两种方式：

#### 方式1：通过代码创建（推荐用于开发环境）

1. 启动后端服务
2. 使用任意方式调用微信登录接口（开发环境使用模拟code）
3. 登录成功后，在数据库中手动修改用户角色：

```javascript
// 在MongoDB中执行
db.users.updateOne(
  { openid: "你的openid" },
  { $set: { role: "admin" } }
)
```

#### 方式2：通过MongoDB客户端

1. 连接MongoDB数据库
2. 找到 `users` 集合
3. 将需要设为管理员的用户记录的 `role` 字段改为 `admin`

## 常见问题

### 1. MongoDB连接失败

**错误**：`MongoDB连接失败`

**解决方案**：
- 确保MongoDB服务已启动
- 检查 `MONGODB_URI` 配置是否正确
- 检查MongoDB是否监听在默认端口27017

### 2. 端口被占用

**错误**：`Port 5000 is already in use`

**解决方案**：
- 修改 `backend/.env` 中的 `PORT` 为其他端口（如5001）
- 同时修改 `frontend/.env` 中的 `REACT_APP_API_URL`

### 3. 微信登录失败

**错误**：`微信登录失败`

**解决方案**：
- 开发环境：代码已包含模拟登录，可以直接使用
- 生产环境：需要配置真实的微信AppID和Secret

### 4. 前端无法连接后端

**解决方案**：
- 检查后端是否正常启动
- 检查 `REACT_APP_API_URL` 配置是否正确
- 检查浏览器控制台是否有CORS错误（后端已配置CORS，通常不会有此问题）

### 5. 依赖安装失败

**解决方案**：
- 清除缓存：`npm cache clean --force`
- 删除 `node_modules` 重新安装
- 使用 `yarn` 替代 `npm`

## 生产环境部署

1. **构建前端**：
   ```bash
   cd frontend
   npm run build
   ```

2. **配置生产环境变量**：
   - 修改 `backend/.env` 中的数据库连接和生产配置
   - 使用真实的微信AppID和Secret
   - 使用强密码作为JWT_SECRET

3. **启动生产服务**：
   ```bash
   # 后端
   cd backend
   npm start
   
   # 前端（使用serve等静态文件服务器）
   npm install -g serve
   serve -s build -l 3000
   ```

## 技术支持

如有问题，请检查：
1. 所有依赖是否正确安装
2. 环境变量是否正确配置
3. MongoDB服务是否正常运行
4. 端口是否被占用
